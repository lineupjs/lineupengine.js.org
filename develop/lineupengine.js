/*! For license information please see lineupengine.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.lineupengine=e():t.lineupengine=e()}(globalThis,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function s(t){return null!=t&&"function"==typeof t.then}t.r(e),t.d(e,{ABORTED:()=>i,ACellRenderer:()=>st,ACellTableSection:()=>ot,ARowRenderer:()=>q,EAnimationMode:()=>u,EScrollResult:()=>P,GridStyleManager:()=>tt,KeyFinder:()=>c,MultiTableRowRenderer:()=>nt,PrefetchMixin:()=>it,StyleManager:()=>Z,abortAble:()=>n,abortAbleAll:()=>l,abortAbleFetch:()=>r,abortAbleResolveNow:()=>d,buildId:()=>lt,defaultPhases:()=>p,frozenDelta:()=>E,isAbortAble:()=>h,isAsyncUpdate:()=>a,isLoadingCell:()=>K,isPromiseLike:()=>s,noAnimationChange:()=>f,nonUniformContext:()=>w,randomContext:()=>S,range:()=>R,setTemplate:()=>G,setTransform:()=>Y,tableCSSClasses:()=>Q,tableIds:()=>J,uniformContext:()=>x,updateFrozen:()=>A,version:()=>rt});const i=Symbol("aborted");function o(t,e,n){return function(r,l){return{then:o(t.then((t=>{const o=e()?i:t,n=r?r(o):o;return s(n)?n.then((t=>e()?i:t)):e()?i:n})),e,n),abort:n,isAborted:e}}}function n(t){let e=null;const s=()=>null===e,n=new Promise((t=>{e=t})),r=()=>{null!=e&&(e(i),e=null)};return{then:o(Promise.race([n,t]),s,r),abort:r,isAborted:s}}function r(t,e){const s=new AbortController,n=new Promise(((o,n)=>{const r=fetch(t,{signal:s.signal,...e||{}});r.then(o),r.catch((t=>{t instanceof DOMException?o(i):n(t)}))})),r=s.abort.bind(s),l=()=>s.signal.aborted;return{then:o(n,l,r),abort:r,isAborted:l}}function l(t){const e=Promise.all(t);let s=null;const n=()=>null===s,r=new Promise((t=>{s=t})),l=()=>{if(null!=s){s(i);for(const e of t)h(e)&&e.abort();s=null}};return{then:o(Promise.race([r,e]),n,l),abort:l,isAborted:n}}function h(t){return null!=t&&t&&"function"==typeof t.then&&"function"==typeof t.abort}function a(t){return null!=t&&t&&h(t.ready)}function d(t){return{then:function(e,i){const o=e?e(t):t;return h(o)?o:s(o)?n(o):{then:d(o),abort:()=>{},isAborted:()=>!1}},abort:()=>{},isAborted:()=>!1}}class c{constructor(t,e){this.context=t,this.key=e,this.cache=[],this.lastFilled=0,this.key2index=new Map,this.context.exceptions.forEach((t=>{this.cache[t.index]=t.y,this.key2index.set(e(t.index),t.index)}))}findValidStart(t){for(let e=t-1;e>=0;e-=1)if(void 0!==this.cache[e])return e;return-1}posByKey(t){const e=this.key2index.get(t);return null!=e?{index:e,pos:this.pos(e)}:this.fillCacheTillKey(t)}pos(t){if(0===this.context.exceptions.length)return t*this.context.defaultRowHeight;const e=this.cache[t];if(void 0!==e)return e;const s=this.findValidStart(t);return s<0?this.fillCache(0,t,0):this.fillCache(s+1,t,this.cache[s]+this.heightOf(s)),this.cache[t]}fillCache(t,e,s,i){if(e<=this.lastFilled){if(!i)return;for(let s=t;s<=e;s+=1)i(s,this.key(s),this.cache[s]);return}let o=s;for(let s=t;s<=e;s+=1){this.cache[s]=o;const t=this.key(s);this.key2index.set(t,s),i&&i(s,t,o),o+=this.heightOf(s)}}heightOf(t){var e;return null!==(e=this.context.exceptionsLookup.get(t))&&void 0!==e?e:this.context.defaultRowHeight}exceptionHeightOf(t,e=!1){const s=this.context.padding(t),i=this.context.exceptionsLookup.get(t);return null!=i?i-s:e?this.context.defaultRowHeight-s:null}padding(t){return this.context.padding(t)}fillCacheTillKey(t){let e=0;for(let s=this.lastFilled;s<this.context.numberOfRows;s+=1,this.lastFilled+=1){const i=this.cache[s];if(void 0!==i){e=i+this.heightOf(s);continue}const o=this.key(s);if(this.cache[s]=e,this.key2index.set(o,s),o===t)return{index:s,pos:e};e+=this.heightOf(s)}return{index:-1,pos:-1}}positions(t,e,s,i){this.fillCache(t,e,s,i)}}var u;function f({previous:t,mode:e,nodeY:s,current:i},o,n){const r=null==t.height?o:t.height,l=null==i.height?n:i.height;return e===u.UPDATE&&Math.abs(t.y-s)<=1&&Math.abs(r-l)<=1}!function(t){t[t.UPDATE=0]="UPDATE",t[t.UPDATE_CREATE=1]="UPDATE_CREATE",t[t.UPDATE_REMOVE=2]="UPDATE_REMOVE",t[t.SHOW=3]="SHOW",t[t.HIDE=4]="HIDE"}(u||(u={}));const p=[{delay:0,apply({mode:t,previous:e,nodeY:s,current:i,node:o}){const n=o;n.dataset.animation=u[t].toLowerCase(),n.style.transform=`translate(0, ${e.y-s}px)`,t===u.SHOW?n.style.height=null!==i.height?`${i.height}px`:"":n.style.height=`${e.height}px`,t===u.SHOW?n.style.opacity="0":t===u.HIDE?n.style.opacity="1":n.style.opacity=""}},{delay:10,apply({mode:t,current:e,nodeY:s,node:i}){const o=i;o.style.transform=t===u.HIDE||t===u.UPDATE_REMOVE?`translate(0, ${e.y-s}px)`:"",t!==u.HIDE&&(o.style.height=null!==e.height?`${e.height}px`:""),t===u.SHOW?o.style.opacity="1":t===u.HIDE?o.style.opacity="0":o.style.opacity=""}},{delay:1100,apply({node:t}){const e=t;delete e.dataset.animation,e.style.opacity="",e.style.transform=""}}];function m(t){for(;t.lastChild;)t.removeChild(t.lastChild);return t}const y="animation";class g{constructor(t){this.node=t,this.sync={handler:[],prev:null,timer:-1},this.animation={handler:[],prev:null,timer:-1},this.numbers=new Map,this.handleAnimationImpl=()=>{1===this.animation.timer&&(this.handle(this.animation),this.animation.timer=-1)},t.addEventListener("scroll",(()=>{this.sync.handler.length>0&&this.handle(this.sync),this.handleAnimation(),this.handleTimeouts()}),{passive:!0})}get current(){return this.asInfo()}handle(t){const e=this.current;if(!(t.prev&&Math.abs(e.left-t.prev.left)+Math.abs(e.top-t.prev.top)<4)){t.prev=e;for(const s of t.handler)s(e)}}handleAnimation(){-1===this.animation.timer&&0!==this.animation.handler.length&&(this.animation.timer=1,requestAnimationFrame(this.handleAnimationImpl))}handleTimeouts(){0!==this.numbers.size&&this.numbers.forEach(((t,e)=>{0!==t.handler.length&&(t.timer=self.setTimeout((()=>{this.handle(t),t.timer=-1}),e))}))}asInfo(){return{left:this.node.scrollLeft,top:this.node.scrollTop,width:this.node.clientWidth,height:this.node.clientHeight}}push(t,e){var s;if("number"==typeof t){const i=null!==(s=this.numbers.get(t))&&void 0!==s?s:{handler:[],prev:null,timer:-1};i.handler.push(e),this.numbers.set(t,i)}switch(t){case"sync":this.sync.handler.push(e);break;case"animation":this.animation.handler.push(e)}}remove(t){return[this.sync,this.animation].concat(Array.from(this.numbers.values())).some((e=>{const s=e.handler.indexOf(t);return s>=0&&e.handler.splice(s,1),s>=0}))}isWaiting(t){var e,s;switch(t){case"animation":return this.animation.timer>=0;case"sync":return!1;default:return(null!==(s=null===(e=this.numbers.get(t))||void 0===e?void 0:e.timer)&&void 0!==s?s:-1)>=0}}}function b(t,e,s){const i=t;i.__le_scroller__||(i.__le_scroller__=new g(t));const o=i.__le_scroller__;return o.push(e,s),o.asInfo()}function v(t,e){const s=t;return!!s.__le_scroller__&&s.__le_scroller__.isWaiting(e)}class C{constructor(t,e,s){this.index=t,this.y=e,this.height=s}get y2(){return this.y+this.height}}function x(t,e,s=0){const i=e+s;return{exceptions:[],exceptionsLookup:{keys:()=>[].values(),get:()=>i,has:()=>!1,size:0},totalHeight:t*i,numberOfRows:t,defaultRowHeight:i,padding:()=>s}}function w(t,e=Number.NaN,s=0){const i=new Map,o=[],n="function"==typeof s?s:()=>s;let r=e;Number.isNaN(r)&&(r=function(t){const e=new Map;if(t.forEach((t=>{e.set(t,(e.get(t)||0)+1)})),0===e.size)return 20;const s=Array.from(e).sort(((t,e)=>t[1]!==e[1]?e[1]-t[1]:t[0]-e[0])),i=s[0][0];return 0===i?s.length>1?s[1][0]:20:i}(t)),r+=n(-1);let l=-1,h=0,a=0,d=0;return t.forEach(((t,e)=>{const s=t+n(e);if(a+=s,d+=1,s===r)return;i.set(e,s);const c=(e-l-1)*r;l=e;const u=h+c;h=u+s,o.push(new C(e,u,s))})),{exceptionsLookup:i,exceptions:o,totalHeight:a,defaultRowHeight:r,numberOfRows:d,padding:n}}function S(t,e,s=2,i=10*e,o=.2,n=Date.now()){let r=n;const l=()=>{const t=1e4*Math.sin(r);return r+=1,t-Math.floor(t)};return w({forEach:n=>{for(let r=0;r<t;r+=1)n(l()<o?s+Math.round(l()*(i-s)):e,r)}},e)}function R(t,e,s,i,o){if(0===o)return{first:0,last:-1,firstRowPos:0,endPos:0};if(1===o)return{first:0,last:0,firstRowPos:0,endPos:0===i.length?s:i[0].y2};const n=t,r=n+e;function l(t,e){return Math.min(o-1,e+Math.max(0,Math.floor(t/s)))}function h(t,e){const i=r-t,o=l(n-t,e),h=l(i,e);return{first:o,last:h,firstRowPos:t+(o-e)*s,endPos:t+(h+1-e)*s}}const a=h(0,0);if(0===i.length)return a;if(a.last<i[0].index)return a;if(a.last===i[0].index&&i[0].height>s)return Object.assign(a,{endPos:i[0].y2});const d=i[i.length-1];if(n>=d.y){const t=h(d.y2,d.index+1);return n<d.y2?Object.assign(t,{first:d.index,firstRowPos:d.y}):t}const c=[];let u=i[0];for(const t of i){const{y:e,y2:s}=t;if(e>=r)break;s<=n?u=t:c.push(t)}if(0===c.length)return h(u.y2,u.index+1);{const t=c[0],e=c[c.length-1],i=Math.max(0,t.index-Math.max(0,Math.ceil((t.y-n)/s)));let o=e.index;return r>=e.y2&&(o=l(r-e.y2,e.index+1)),{first:i,last:o,firstRowPos:t.y-(t.index-i)*s,endPos:e.y2+(o-e.index)*s}}}function E(t,e){const s=t.length,i=e.length;if(0===s)return{added:e,removed:[],common:0};if(0===i)return{added:[],removed:t,common:0};if(s===i)return{added:[],removed:[],common:s};const o=t.slice(Math.min(i,s));return{added:e.slice(Math.min(i,s)),removed:o,common:s-o.length}}function A(t,e,s){const i=0===t.length?0:t[t.length-1]+1,o=[],n=[];for(let e=t.length-1;e>=0&&t[e]>=s;e-=1)n.push(t.pop());for(let n=i;n<s;n+=1)e[n].frozen&&(o.push(n),t.push(n));return{target:t,added:o,removed:n}}var P;function $(t){return t?`le-${t}`:"le"}!function(t){t[t.NONE=0]="NONE",t[t.ALL=1]="ALL",t[t.SOME=2]="SOME",t[t.SOME_BOTTOM=3]="SOME_BOTTOM",t[t.SOME_TOP=4]="SOME_TOP"}(P||(P={}));const O=$("loading"),F=$("frozen"),H=$("hidden"),T=$("multi"),z=$("even"),L=$("shifted"),M=$("scrollbar-tester"),_=$("header"),B=$("body"),I=$("footer"),D=$("thead"),U=$("tbody"),W=$("tr"),N=$("th"),k=$("td"),V=$("scrolling"),j=$("row-animation");function K(t){return t.classList.contains(O)}class q{constructor(t,e={}){this.body=t,this.pool=[],this.loadingPool=[],this.loading=new WeakMap,this.visible={first:0,forcedFirst:0,last:-1,forcedLast:-1},this.visibleFirstRowPos=0,this.scrollListener=null,this.lastScrollInfo=null,this.abortAnimation=()=>{},this.options={async:y,minScrollDelta:10,mixins:[],scrollingHint:!1,batchSize:10,striped:!1,viewportOversize:200},this.adapter=this.createAdapter(),Object.assign(this.options,e),this.mixins=this.options.mixins.map((t=>new t(this.adapter))),this.fragment=t.ownerDocument.createDocumentFragment()}addMixin(t,e){this.mixins.push(new t(this.adapter,e))}createAdapter(){const t=this;return{visible:this.visible,addAtBeginning:(t,e)=>this.addAtBeginning(t,e),addAtBottom:this.addAtBottom.bind(this),removeFromBeginning:(t,e)=>this.removeFromBeginning(t,e),removeFromBottom:this.removeFromBottom.bind(this),updateOffset:this.updateOffset.bind(this),isScrollEventWaiting:()=>v(this.bodyScroller,this.options.async),get visibleFirstRowPos(){return t.visibleFirstRowPos},get context(){return t.context},get scrollOffset(){return t.lastScrollInfo?t.lastScrollInfo.top:0},get scrollTotal(){return t.lastScrollInfo?t.lastScrollInfo.height:t.bodyScroller.clientHeight}}}get bodyScroller(){return this.body.parentElement}get bodySizer(){const t=this.bodyScroller,e=Array.from(t.children).find((t=>"footer"===t.tagName.toLowerCase()));if(e)return e;const s=t.ownerDocument.createElement("footer");return s.classList.add(I,$(`footer-${this.idPrefix}`)),t.insertBefore(s,t.firstChild),s}init(){const t=this.bodyScroller;let e=b(t,this.options.async,this.scrollListener=t=>{if(this.lastScrollInfo=t,Math.abs(e.top-t.top)<this.options.minScrollDelta&&Math.abs(e.height-t.height)<this.options.minScrollDelta)return;const s=t.top>e.top;e=t,this.onScrolledVertically(t.top,t.height,s),this.options.scrollingHint&&this.body.classList.remove(V)});this.options.scrollingHint&&b(t,"animation",(()=>this.body.classList.add(V))),this.recreate()}destroy(){this.scrollListener&&function(t,e){const s=t;s.__le_scroller__&&s.__le_scroller__.remove(e)}(this.bodyScroller,this.scrollListener),this.body.remove()}static cleanUp(t){t.style.height=""}select(t){let e,s=this.pool.pop();return null!=s?e=this.updateRow(s,t):(s=this.loadingPool.pop(),null!=s?(s.classList.remove(O),e=this.createRow(s,t)):(s=this.body.ownerDocument.createElement("div"),s.classList.add(W,$(`tr-${this.idPrefix}`)),e=this.createRow(s,t))),s.dataset.index=String(t),this.options.striped&&s.classList.toggle(z,t%2==0),{item:s,result:e}}selectProxy(){let t=this.loadingPool.pop();return null==t&&(t=this.body.ownerDocument.createElement("div"),t.classList.add(O,W,$(`tr-${this.idPrefix}`))),t}recycle(t){q.cleanUp(t);const e=this.loading.get(t);null!=e?e.abort():this.pool.push(t)}proxy(t,e){if(!h(e))return t;const s=e,o=t,n=this.selectProxy();return n.dataset.index=o.dataset.index,n.style.height=o.style.height,this.loading.set(n,s),s.then((t=>{t===i?(q.cleanUp(o),this.pool.push(o)):this.body.replaceChild(o,n),this.loading.delete(n),q.cleanUp(n),this.loadingPool.push(n)}),(()=>{q.cleanUp(o),this.pool.push(o),this.loading.delete(n),q.cleanUp(n),this.loadingPool.push(n)})),n}create(t){const{item:e,result:s}=this.select(t),{exceptionsLookup:i,padding:o}=this.context,n=i.get(t);return null!=n&&(e.style.height=n-o(t)+"px"),this.proxy(e,s)}removeAll(t=!0){const e=this.body;if(!t)return Array.from(e.children);const s=[];for(;e.lastElementChild;){const t=e.lastElementChild;e.removeChild(t),this.recycle(t),s.push(t)}return s}update(){const{first:t}=this.visible,{fragment:e}=this,s=Array.from(this.body.children);m(this.body),s.forEach(((s,i)=>{if(this.loading.has(s))return void e.appendChild(s);const o=this.updateRow(s,i+t);e.appendChild(this.proxy(s,o))})),this.body.appendChild(e)}forEachRow(t,e=!1){const s=Array.from(this.body.children),{fragment:i}=this;e||m(this.body),s.forEach(((s,o)=>{K(s)||"update_remove"===s.dataset.animation||"hide"===s.dataset.animation||t(s,o+this.visible.first),e||i.appendChild(s)})),e||this.body.appendChild(i)}removeFromBeginning(t,e,s=!0){return this.remove(t,e,!0,s)}removeFromBottom(t,e,s=!0){return this.remove(t,e,!1,s)}remove(t,e,s,i=!0){if(e<t)return[];const o=this.body,n=[];let r=s?o.firstChild:o.lastChild;for(let l=t;l<=e;l+=1){const t=r;r=s?r.nextSibling:r.previousSibling,i&&(o.removeChild(t),this.recycle(t)),n.push(t)}return n}addAtBeginning(t,e,s=!0){if(e<t)return null;const{fragment:i}=this;if(t===e&&s)return this.body.insertBefore(this.create(t),this.body.firstChild),null;for(let s=t;s<=e;s+=1)i.appendChild(this.create(s));return s&&this.body.insertBefore(i,this.body.firstChild),i}addAtBottom(t,e,s=!0){if(e<t)return null;if(t===e&&s)return this.body.appendChild(this.create(t)),null;const{fragment:i}=this;for(let s=t;s<=e;s+=1)i.appendChild(this.create(s));return s&&this.body.appendChild(i),i}updateOffset(t){this.visibleFirstRowPos=t,this.updateSizer(t)}updateSizer(t){const{totalHeight:e}=this.context;Y(this.body,0,t.toFixed(0)),Y(this.bodySizer,0,Math.max(0,e-1).toFixed(0))}recreate(t){return this.abortAnimation(),t?this.recreateAnimated(t):this.recreatePure()}recreatePure(){const{context:t}=this,e=this.bodyScroller;this.updateOffset(0),this.removeAll(),this.clearPool();const{first:s,last:i,firstRowPos:o}=R(e.scrollTop,e.clientHeight,t.defaultRowHeight,t.exceptions,t.numberOfRows);this.visible.first=s,this.visible.forcedFirst=s,this.visible.last=i,this.visible.forcedLast=i,s<0?this.updateOffset(0):(this.addAtBottom(s,i),this.updateOffset(o))}recreateAnimated(t){const e=new Map,s=new c(t.previous,t.previousKey),i=new c(this.context,t.currentKey),o=R(this.bodyScroller.scrollTop,this.bodyScroller.clientHeight,i.context.defaultRowHeight,i.context.exceptions,i.context.numberOfRows);{const t=Array.from(this.body.children),i={...this.visible};m(this.body),s.positions(i.first,Math.min(i.last,i.first+t.length),this.visibleFirstRowPos,((s,i,o)=>{const n=t[s];n&&e.set(i,{n,pos:o,i:s})}))}this.visible.first=o.first,this.visible.forcedFirst=o.first,this.visible.last=o.last,this.visible.forcedLast=o.last;const{fragment:n}=this,r=[];let l=o.firstRowPos;i.positions(o.first,o.last,o.firstRowPos,((t,o,h)=>{let a,d,c=u.UPDATE;const f=e.get(o);if(null!=f)e.delete(o),f.n.dataset.index=String(t),a=this.proxy(f.n,this.updateRow(f.n,t)),d={index:f.i,y:f.pos,height:s.exceptionHeightOf(f.i,!0)};else{const e=s.posByKey(o);a=this.create(t),c=e.index<0?u.SHOW:u.UPDATE_CREATE,d={index:e.index,y:e.pos>=0?e.pos:h,height:e.index<0?i.exceptionHeightOf(t,!0):s.exceptionHeightOf(e.index,!0)}}r.push({node:a,key:o,mode:c,previous:d,nodeY:l,nodeYCurrentHeight:h,current:{index:t,y:h,height:i.exceptionHeightOf(t)}}),a.style.transform=`translate(0, ${l-h}px)`,l+=d.height+(d.index<0?i.padding(t):s.padding(d.index)),n.appendChild(a)}));let h=o.endPos;e.forEach(((t,e)=>{const o=i.posByKey(e),a=o.pos>=0?o.pos:t.pos,d=t.n;d.style.transform=`translate(0, ${t.pos-l}px)`,n.appendChild(d);const c=s.exceptionHeightOf(t.i,!0);r.push({node:t.n,key:e,mode:o.index<0?u.HIDE:u.UPDATE_REMOVE,previous:{index:t.i,y:t.pos,height:c},nodeY:l,nodeYCurrentHeight:h,current:{index:o.index,y:a,height:o.index<0?null:i.exceptionHeightOf(o.index)}}),h+=o.index<0?i.context.defaultRowHeight:i.exceptionHeightOf(o.index,!0)+i.padding(o.index),l+=c+s.padding(t.i)})),this.updateOffset(o.firstRowPos),this.animate(r,t.phases||p,s,i,n)}animate(t,e,s,i,o){let n=t;if(n.length<=0)return void this.body.appendChild(o);let r=-1,l=0;const h=(t,e=n)=>{e.forEach((e=>t.apply(e,s,i)))},a=()=>{if(console.assert(n[0].node.offsetTop>=0,"dummy log for forcing dom update"),h(e[l]),l+=1,l<e.length){const t=e[l];return void(r=self.setTimeout(a,t.delay))}const t=this.body.classList;Array.from(t).forEach((e=>{e.startsWith($())&&e.endsWith("-animation")&&t.remove(e)})),n.forEach((({node:t,mode:e})=>{e!==u.UPDATE_REMOVE&&e!==u.HIDE||(t.remove(),t.style.transform="",this.recycle(t))})),this.abortAnimation=()=>{},r=-1};for(;0===e[l].delay;)h(e[l]),l+=1;const{body:d}=this;this.body.appendChild(o);const c=[];n=n.filter((t=>!f(t,s.context.defaultRowHeight,i.context.defaultRowHeight)||(c.push(t),!1))),c.length>0&&e.slice(l).forEach((t=>h(t,c))),0!==n.length&&(d.classList.add(j),new Set(n.map((t=>t.mode))).forEach((t=>{d.classList.add($(`${u[t].toLowerCase().split("_")[0]}-animation`))})),this.abortAnimation=()=>{r<=0||(clearTimeout(r),r=-1,l=e.length-1,a())},r=self.setTimeout(a,e[l].delay))}clearPool(){this.pool.splice(0,this.pool.length)}revalidate(){const t=this.bodyScroller;this.onScrolledVertically(t.scrollTop,t.clientHeight,!0),this.updateOffset(this.visibleFirstRowPos)}onScrolledVertically(t,e,s){const i=this.options.viewportOversize,o=Math.max(0,t-i),n=this.onScrolledImpl(o,e+i+(t-o));for(const t of this.mixins)t.onScrolled(s,n);return n}shiftLast(t,e){if(e>=this.options.batchSize)return t;const s=this.context.numberOfRows;return Math.min(s-1,t+(this.options.batchSize-e))}shiftFirst(t,e,s){var i;if(s>=this.options.batchSize||t<=0)return{first:t,firstRowPos:e};const o=Math.max(0,t-(this.options.batchSize-s)),{exceptionsLookup:n,defaultRowHeight:r}=this.context;let l=e;for(let e=o;e<t;e+=1)l-=null!==(i=n.get(e))&&void 0!==i?i:r;return{first:o,firstRowPos:l}}onScrolledImpl(t,e){const{context:s}=this;let{first:i,last:o,firstRowPos:n}=R(t,e,s.defaultRowHeight,s.exceptions,s.numberOfRows);const{visible:r}=this;if(r.forcedFirst=i,r.forcedLast=o,i-r.first>=0&&o-r.last<=0)return P.NONE;let l,h,a=P.SOME,d=!1;if(i>r.last||o<r.first)l=this.removeAll(!1),h=this.addAtBottom(i,o,!1),d=!0,a=P.ALL;else if(i<r.first){r.last-(o+1)>=this.options.batchSize?l=this.removeFromBottom(o+1,r.last,!1):o=r.last;const t=this.shiftFirst(i,n,r.first-1-i);i=t.first,n=t.firstRowPos,h=this.addAtBeginning(i,r.first-1,!1),d=!1,a=P.SOME_TOP}else i-1-r.first>=this.options.batchSize?l=this.removeFromBeginning(r.first,i-1,!1):(i=r.first,n=this.visibleFirstRowPos),o=this.shiftLast(o,o-r.last+1),h=this.addAtBottom(r.last+1,o,!1),d=!0,a=P.SOME_BOTTOM;return r.first=i,r.last=o,this.updateOffset(n),this.manipulate(l,h,d),a}manipulate(t,e,s){if(t)for(const e of t)e.remove(),this.recycle(e);e&&(s?this.body.appendChild(e):this.body.insertBefore(e,this.body.firstChild))}}function Y(t,e,s){const i=`translate(${e}px, ${s}px)`,o=t;o.__transform__!==i&&(o.__transform__=i,t.style.transform=i)}function X(t,e){const s=t;for(const i of Object.keys(e)){const o=e[i];if(!o.endsWith(" !important")){s[i]!==o&&(s[i]=o);continue}const n=o.slice(0,-" !important".length);if(s[i]===n)continue;s[i]=n;const r=i.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase();t.setProperty(r,n,"important")}}class Z{constructor(t){this.rules=[],this.testVerifyTimeout=-1,this.node=t.ownerDocument.createElement("style"),this.node.appendChild(t.ownerDocument.createTextNode("")),t.appendChild(this.node)}destroy(){this.node.remove()}verifySheet(){const{sheet:t}=this;if(!t){if(this.testVerifyTimeout>=0)return;return void(this.testVerifyTimeout=self.setTimeout((()=>{this.testVerifyTimeout=-1,this.verifySheet()}),20))}const e=t.cssRules;if(e.length===this.rules.length&&this.rules.every(((t,s)=>e[s].selectorText===t.selector)))return;const s=e.length;for(let e=0;e<s;e+=1)t.deleteRule(e);for(const e of this.rules){const s=t.insertRule(`${e.selector} {}`,t.cssRules.length),i=t.cssRules[s];e.selector=i.selectorText,X(i.style,e.style)}}get sheet(){return this.node.sheet}getSheetRule(t){const{sheet:e}=this;return e?e.cssRules[t]:null}addRule(t,e,s){this.verifySheet();const{sheet:i}=this;if(!i)return this.rules.push({id:t,selector:e,style:s}),null;const o=i.insertRule(`${e} {}`,i.cssRules.length),n=i.cssRules[o];return this.rules.push({id:t,selector:n.selectorText,style:s}),X(n.style,s),t}updateRule(t,e,s){this.verifySheet();const i=this.rules.findIndex((e=>e.id===t));if(i<0)return this.addRule(t,e,s);const o=this.rules[i];o.selector=e,o.style=s;const n=this.getSheetRule(i);return n&&(n.selectorText.replace(/\s/gm,"")!==e.replace(/\s/gm,"")&&(n.selectorText=e,o.selector=n.selectorText),X(n.style,s)),t}deleteRule(t){this.verifySheet();const e=this.rules.findIndex((e=>e.id===t));if(e<0)return;this.rules.splice(e,1);const{sheet:s}=this;s&&s.deleteRule(e)}get ruleNames(){return this.rules.map((t=>t.id))}}function G(t,e){const s=e.startsWith("#")?e.slice(1):e;return t.innerHTML=`\n  <header id="header-${s}" class="${_} ${$(`header-${s}`)}">\n    <article class="${D} ${$(`thead-${s}`)}"></article>\n  </header>\n  <main id="body-${s}" class="${B} ${$(`body-${s}`)}">\n    <footer class="${I}">&nbsp;</footer>\n    <article class="${U} ${$(`tbody-${s}`)}"></article>\n  </main>`,t}function J(t){return{thead:`thead-${t}`,tbody:`tbody-${t}`,tr:`tr-${t}`,th:`th-${t}`,td:`td-${t}`}}function Q(t){const e=J(t);return{thead:$(e.thead),tbody:$(e.tbody),tr:$(e.tr),th:$(e.th),td:$(e.td)}}class tt extends Z{constructor(t,e){super(t),this.id=e.startsWith("#")?e.slice(1):e,this.ids=J(this.id),this.cssClasses=Q(this.id);const s=t.getElementsByTagName("header")[0],i=t.getElementsByTagName("main")[0];self.setTimeout((()=>{const{width:e}=function(t){var e;const s=null===(e=t.ownerDocument)||void 0===e?void 0:e.body;if(!s)return{width:10,height:10};s.insertAdjacentHTML("beforeend",`<div class="${M}"><div></div></div>`);const i=s.lastElementChild,o=i.offsetWidth-i.clientWidth,n=i.offsetHeight-i.clientHeight;return i.remove(),{width:o,height:n}}(t);this.updateRule("__scrollBarFix2",`#header-${this.id} > article:last-of-type`,{borderRight:`${e}px solid transparent`})}),20);let o=s.scrollLeft;b(i,"animation",(e=>{const i=e.left;o!==i&&(s.scrollLeft=i,o=i),t.classList.toggle(L,e.left>0)}))}update(t,e,s,i,o,n="px"){const r=J(o),l=Q(o),h=`${e.reduce(((t,e,i)=>t+e.width+s(i)),0)}${n}`;this.updateRule(`__heightsRule${l.tr}`,`.${l.tr}`,{height:`${t}px`,width:h}),this.updateRule(`__heightsRule${l.tbody}`,`#${r.tbody}`,{width:h}),this.updateColumns(e,s,l,i,n)}remove(t){const e=Q(t);this.deleteRule(`__heightsRule${e.tr}`),this.deleteRule(`__heightsRule${e.tbody}`);const s=`__col${e.td}_`,i=this.ruleNames.reduce(((t,e)=>t+(e.startsWith(s)?1:0)),0);for(let t=0;t<i;t+=1)this.deleteRule(`${s}${t}`)}updateColumns(t,e,s,i,o="px"){const n=`__col${s.td}_`,r=new Set(this.ruleNames.filter((t=>t.startsWith(n))));let l=0;t.forEach(((t,h)=>{const a=`.${s.th}[data-id="${t.id}"]`,d={width:`${t.width}${o}`},c=`.${s.td}[data-id="${t.id}"]`,u={transform:`translateX(${l}${o})`,width:`${t.width}${o}`};t.frozen&&(d.left=`${l}px`,this.updateRule(`${n}${c}F`,`.${s.td}.${L}[data-id="${t.id}"]`,{transform:"translateX(0)",left:`${l+i}${o}`}),r.delete(`${n}${c}F`)),this.updateRule(`${n}${a}`,a,d),r.delete(`${n}${a}`),this.updateRule(`${n}${c}`,c,u),r.delete(`${n}${c}`),l+=t.width+e(h)})),r.forEach((t=>this.deleteRule(t)))}}class et{constructor(t,e,s,i=[]){this.header=t,this.style=e,this.tableId=s,this.cellPool=[],this.loading=new WeakMap,this.visibleColumns={frozen:[],first:0,forcedFirst:0,last:-1,forcedLast:-1},this.visibleFirstColumnPos=0,this.horizontallyShifted=!1,this.columnAdapter=this.createColumnAdapter(),this.columnMixins=i.map((t=>new t(this.columnAdapter))),this.columnFragment=t.ownerDocument.createDocumentFragment()}leftShift(){const t=this.context,e=this.visibleColumns.frozen.reduce(((e,s)=>e+t.columns[s].width+t.column.padding(s)),0);return this.visibleFirstColumnPos-e}get headerScroller(){return this.header.parentElement}addColumnMixin(t,e){this.columnMixins.push(new t(this.columnAdapter,e))}createColumnAdapter(){const t=this;return{visible:this.visibleColumns,addAtBeginning:this.addColumnAtStart.bind(this),addAtBottom:this.addColumnAtEnd.bind(this),removeFromBeginning:this.removeColumnFromStart.bind(this),removeFromBottom:this.removeColumnFromEnd.bind(this),updateOffset:this.updateColumnOffset.bind(this),scroller:this.headerScroller,syncFrozen:this.syncFrozen.bind(this),isScrollEventWaiting:()=>v(this.headerScroller,"animation"),get visibleFirstRowPos(){return t.visibleFirstColumnPos},get context(){return t.context.column},get scrollOffset(){return t.lastScrollInfo?t.lastScrollInfo.left:0},get scrollTotal(){return t.lastScrollInfo?t.lastScrollInfo.width:t.headerScroller.clientWidth}}}init(){const{context:t}=this;this.style.update(t.defaultRowHeight-t.padding(-1),t.columns,t.column.padding,0,this.tableId),t.columns.forEach((()=>{this.cellPool.push([])}))}onScrolledHorizontally(t,e,s){const i=this.onScrolledHorizontallyImpl(t,e);for(const t of this.columnMixins)t.onScrolled(s,i);return i}removeColumnFromStart(t,e,s=this.visibleColumns.frozen.length){this.forEachRow((i=>{this.removeCellFromStart(i,t,e,s)}))}removeCellFromStart(t,e,s,i){for(let o=e;o<=s;o+=1){const e=0===i?t.firstElementChild:t.children[i];e.remove(),this.recycleCell(e,o)}}removeColumnFromEnd(t,e){this.forEachRow((s=>{this.removeCellFromEnd(s,t,e)}))}removeCellFromEnd(t,e,s){for(let i=s;i>=e;i-=1){const e=t.lastElementChild;e.remove(),this.recycleCell(e,i)}}removeFrozenCells(t,e,s){for(const i of e){const e=t.children[s];e.remove(),this.recycleCell(e,i)}}removeFrozenColumns(t,e){this.forEachRow((s=>{this.removeFrozenCells(s,t,e)}))}removeAllColumns(t){this.forEachRow((e=>{this.removeAllCells(e,t)}))}removeAllCells(t,e,s=this.visibleColumns.first){const i=Array.from(t.children),{frozen:o}=this.visibleColumns;if(m(t),e||0===o.length)for(const t of o)this.recycleCell(i.shift(),t);else for(let e=0;e<o.length;e+=1)t.appendChild(i.shift());i.forEach(((t,e)=>{this.recycleCell(t,e+s)}))}selectProxyCell(t,e,s){const i=this.cellPool[e],o=s[e];let n,r;const l=i.pop(),h=l?this.updateCell(l,t,o)||l:this.createCell(this.header.ownerDocument,t,o);return a(h)?(n=h.item,r=h.ready):n=h,n!==l&&(n.dataset.id=o.id,n.classList.add(k,this.style.cssClasses.td,$(`td-${this.tableId}`))),this.updateShiftedState(n,o),{item:n,ready:r}}handleCellReady(t,e,s=-1){t.classList.add(O);const o=e;return this.loading.set(t,o),o.then((e=>{this.loading.delete(t),t.classList.remove(O),e===i&&s>=0&&this.cellPool[s].push(t)})),t}selectCell(t,e,s){const{item:i,ready:o}=this.selectProxyCell(t,e,s);return h(o)?this.handleCellReady(i,o,e):i}updateShiftedState(t,e){t.classList.toggle(L,e.frozen&&this.horizontallyShifted)}recycleCell(t,e=-1){const s=this.loading.get(t);null!=s?s.abort():!K(t)&&e>=0&&this.cellPool[e].push(t)}addColumnAtStart(t,e,s=this.visibleColumns.frozen.length){const{columns:i}=this.context;this.forEachRow(((o,n)=>{this.addCellAtStart(o,n,t,e,s,i)}))}addCellAtStart(t,e,s,i,o,n){for(let r=i;r>=s;r-=1){const s=this.selectCell(e,r,n);t.insertBefore(s,o>0?t.children[o]:t.firstChild)}}insertFrozenCells(t,e,s,i,o){const n=t.children[i];for(const i of s){const s=this.selectCell(e,i,o);n?t.insertBefore(s,n):t.appendChild(s)}}insertFrozenColumns(t,e){const{columns:s}=this.context;this.forEachRow(((i,o)=>{this.insertFrozenCells(i,o,t,e,s)}))}addColumnAtEnd(t,e){const{columns:s}=this.context;this.forEachRow(((i,o)=>{this.addCellAtEnd(i,o,t,e,s)}))}addCellAtEnd(t,e,s,i,o){for(let n=s;n<=i;n+=1){const s=this.selectCell(e,n,o);t.appendChild(s)}}updateHeaders(){const{columns:t}=this.context;Array.from(this.header.children).forEach(((e,s)=>{const i=e,o=t[s],n=this.updateHeader(i,o);let r;r=a(n)?this.handleCellReady(n.item,n.ready,-1):n||i,r!==i&&(r.dataset.id=o.id,r.classList.add(N,this.style.cssClasses.th,$(`th-${this.tableId}`)),this.header.replaceChild(i,r))}))}recreate(t,e){var s;const{context:i}=this;this.style.update(i.defaultRowHeight-i.padding(-1),i.columns,i.column.padding,0,this.tableId),this.clearPool();for(let t=this.cellPool.length;t<i.columns.length;t+=1)this.cellPool.push([]);{const t=this.columnFragment,e=t.ownerDocument,o=new Map;for(;this.header.lastChild;){const t=this.header.lastChild;this.header.removeChild(t),o.set(null!==(s=t.dataset.id)&&void 0!==s?s:"",t)}i.columns.forEach((s=>{const i=o.get(s.id),n=i?this.updateHeader(i,s)||i:this.createHeader(e,s);let r;r=a(n)?this.handleCellReady(n.item,n.ready,-1):n,r!==i&&(r.dataset.id=s.id,r.classList.add(N,this.style.cssClasses.th,$(`th-${this.tableId}`))),t.appendChild(r)})),this.header.appendChild(t)}const{first:o,last:n,firstRowPos:r}=R(t,e,i.column.defaultRowHeight,i.column.exceptions,i.column.numberOfRows);if(this.visibleColumns.first=o,this.visibleColumns.forcedFirst=o,this.visibleColumns.last=n,this.visibleColumns.forcedLast=n,i.columns.some((t=>t.frozen))){const{target:t}=A([],i.columns,o);this.visibleColumns.frozen=t}else this.visibleColumns.frozen=[];this.updateColumnOffset(r)}clearPool(){this.cellPool.forEach((t=>t.splice(0,t.length)))}updateColumnOffset(t){const e=t!==this.visibleFirstColumnPos;if(this.visibleFirstColumnPos=t,e){const{context:t}=this;this.style.update(t.defaultRowHeight-t.padding(-1),t.columns,t.column.padding,0,this.tableId)}}createRow(t,e){const{columns:s}=this.context,i=this.visibleColumns;if(i.frozen.length>0)for(const o of i.frozen){const i=this.selectCell(e,o,s);t.appendChild(i)}for(let o=i.first;o<=i.last;o+=1){const i=this.selectCell(e,o,s);t.appendChild(i)}}updateRow(t,e){var s;const{columns:i}=this.context,o=this.visibleColumns;switch(t.childElementCount){case 0:o.frozen.length>0&&this.insertFrozenCells(t,e,o.frozen,0,i),this.addCellAtEnd(t,e,o.first,o.last,i);break;case 1:{const n=t.firstElementChild,r=null!==(s=n.dataset.id)&&void 0!==s?s:"",l=i.findIndex((t=>t.id===r));t.removeChild(n),l>=0&&this.recycleCell(n,l),o.frozen.length>0&&this.insertFrozenCells(t,e,o.frozen,0,i),this.addCellAtEnd(t,e,o.first,o.last,i);break}default:this.mergeColumns(t,e)}}mergeColumns(t,e){const{columns:s}=this.context,i=this.visibleColumns,o=new Map;for(;t.lastChild;){const e=t.lastChild;t.removeChild(e),o.set(e.dataset.id,e)}const n=i=>{const n=s[i],r=o.get(n.id);if(!r){const o=this.selectCell(e,i,s);return void t.appendChild(o)}o.delete(n.id);const l=this.updateCell(r,e,n)||r;let h;h=a(l)?this.handleCellReady(l.item,l.ready,i):l,h&&h!==r&&(h.dataset.id=n.id,h.classList.add(k,this.style.cssClasses.td,$(`td-${this.tableId}`))),this.updateShiftedState(h,n),t.appendChild(h)};for(const t of i.frozen)n(t);for(let t=i.first;t<=i.last;t+=1)n(t);if(0===o.size)return;const r=new Map(s.map(((t,e)=>[t.id,e])));o.forEach(((t,e)=>{const s=r.get(e);null!=s&&s>=0&&this.recycleCell(t,s)}))}updateShiftedStates(){if(!this.context.columns.some((t=>t.frozen)))return;const t=this.horizontallyShifted,e=L;if(t){const t=Array.from(this.header.querySelectorAll(`.${F}:not(.${e})`)),s=Array.from(this.body.querySelectorAll(`.${F}:not(.${e})`));for(const s of t)s.classList.add(e);for(const t of s)t.classList.add(e)}else{const t=Array.from(this.header.querySelectorAll(`.${F}.${e}`)),s=Array.from(this.body.querySelectorAll(`.${F}.${e}`));for(const s of t)s.classList.remove(e);for(const t of s)t.classList.remove(e)}}syncFrozen(t){const{columns:e}=this.context,s=this.visibleColumns;if(!e.some((t=>t.frozen)))return 0;if(0===t)return s.frozen.length>0&&(this.removeFrozenColumns(s.frozen,0),s.frozen=[]),0;const i=s.frozen.length,{target:o,added:n,removed:r}=A(s.frozen,e,t);return r.length>0&&this.removeFrozenColumns(r,i-r.length),n.length>0&&this.insertFrozenColumns(n,i-r.length),s.frozen=o,o.length}onScrolledHorizontallyImpl(t,e){const s=this.horizontallyShifted!==t>0;this.horizontallyShifted=t>0;const{column:i}=this.context,{first:o,last:n,firstRowPos:r}=R(t,e,i.defaultRowHeight,i.exceptions,i.numberOfRows),l=this.visibleColumns;if(l.forcedFirst=o,l.forcedLast=n,o-l.first>=0&&n-l.last<=0)return s&&this.updateShiftedStates(),P.NONE;let h=P.SOME;const a=this.syncFrozen(o);return o>l.last||n<l.first?(this.removeAllColumns(!1),this.addColumnAtEnd(o,n),h=P.ALL):o<l.first?(this.removeColumnFromEnd(n+1,l.last),this.updateShiftedStates(),this.addColumnAtStart(o,l.first-1,a),h=P.SOME_TOP):(this.removeColumnFromStart(l.first,o-1,a),this.updateShiftedStates(),this.addColumnAtEnd(l.last+1,n),h=P.SOME_BOTTOM),l.first=o,l.last=n,this.updateColumnOffset(r),h}}class st extends q{constructor(t,e,s={}){super(G(t,e).querySelector("main > article"),s),this.root=t,t.classList.add($(),"lineup-engine"),this.style=new tt(this.root,e);const i=this;this.cell=new class extends et{get context(){return i.context}get body(){return i.body}get lastScrollInfo(){return i.lastScrollInfo}createHeader(t,e){return i.createHeader(t,e)}updateHeader(t,e){return i.updateHeader(t,e)}createCell(t,e,s){return i.createCell(t,e,s)}updateCell(t,e,s){return i.updateCell(t,e,s)}updateColumnOffset(t){super.updateColumnOffset(t),i.updateOffset(i.visibleFirstRowPos)}forEachRow(t){return i.forEachRow(t)}}(this.header,this.style,this.style.id,s.mixins||[])}get idPrefix(){return this.style.id}get header(){return this.root.querySelector("header > article")}get headerScroller(){return this.root.getElementsByTagName("header")[0]}get visibleColumns(){return this.cell.visibleColumns}get visibleFirstColumnPos(){return this.cell.visibleFirstColumnPos}addColumnMixin(t,e){this.cell.addColumnMixin(t,e)}init(){this.cell.init();let t=b(this.body.parentElement,this.options.async,(e=>{if(Math.abs(t.left-e.left)<this.options.minScrollDelta&&Math.abs(t.width-e.width)<this.options.minScrollDelta)return;const s=e.left>t.left;t=e,this.onScrolledHorizontally(e.left,e.width,s)}));super.init()}destroy(){super.destroy(),this.root.remove()}onScrolledHorizontally(t,e,s){return this.cell.onScrolledHorizontally(t,e,s)}updateHeaders(){this.cell.updateHeaders()}handleCellReady(t,e,s=-1){return this.cell.handleCellReady(t,e,s)}recycleCell(t,e=-1){this.cell.recycleCell(t,e)}updateColumnWidths(){const{context:t}=this;this.style.update(t.defaultRowHeight-t.padding(-1),t.columns,t.column.padding,0,this.idPrefix)}updateSizer(t){const e=this.context,{totalHeight:s}=e,i=e.column.totalHeight;this.updateShifts(t,this.cell.leftShift()),this.bodySizer.style.transform=`translate(${Math.max(0,i-1).toFixed(0)}px, ${Math.max(0,s-1).toFixed(0)}px)`}updateShifts(t,e){Y(this.body,0,t.toFixed(0))}recreate(t){const e=this.bodyScroller,s=e.scrollLeft;this.cell.recreate(s,e.clientWidth),super.recreate(t),e.scrollLeft=s}clearPool(){super.clearPool(),this.cell.clearPool()}createRow(t,e){this.cell.createRow(t,e)}updateRow(t,e){this.cell.updateRow(t,e)}}class it{constructor(t,e){return this.adapter=t,this.prefetchTimeout=-1,this.cleanupTimeout=-1,this.options={prefetchRows:20,cleanUpRows:10,delay:200},Object.assign(this.options,e),this}prefetchDown(){if(this.prefetchTimeout=-1,this.adapter.isScrollEventWaiting())return;const{context:t}=this.adapter,e=Math.min(this.adapter.visible.forcedLast+this.options.prefetchRows,t.numberOfRows-1);this.adapter.visible.last===e&&this.adapter.visible.last>=this.adapter.visible.forcedLast+this.options.prefetchRows||(this.adapter.addAtBottom(this.adapter.visible.last+1,e),this.adapter.visible.last=e)}prefetchUp(){if(this.prefetchTimeout=-1,this.adapter.isScrollEventWaiting()||this.adapter.visible.first<=this.adapter.visible.forcedFirst-this.options.prefetchRows)return;const{context:t}=this.adapter,e=Math.max(this.adapter.scrollOffset-this.options.prefetchRows*t.defaultRowHeight,0),s=this.adapter.scrollTotal,{first:i,firstRowPos:o}=R(e,s,t.defaultRowHeight,t.exceptions,t.numberOfRows);if(i===this.adapter.visible.first)return;const n=this.adapter.syncFrozen?this.adapter.syncFrozen(i):0;this.adapter.addAtBeginning(i,this.adapter.visible.first-1,n),this.adapter.visible.first=i,this.adapter.updateOffset(o)}triggerPrefetch(t){this.prefetchTimeout>=0&&clearTimeout(this.prefetchTimeout);const e=this.adapter.visible.last<this.adapter.visible.forcedLast+this.options.prefetchRows,s=this.adapter.visible.first>this.adapter.visible.forcedFirst-this.options.prefetchRows,i=this.adapter.visible.last===this.adapter.context.numberOfRows,o=0===this.adapter.visible.first;if(t&&!e&&!i||!t&&!s&&!o)return;const n=t||o?this.prefetchDown.bind(this):this.prefetchUp.bind(this);this.prefetchTimeout=self.setTimeout(n,this.options.delay)}cleanUpTop(t){if(this.cleanupTimeout=-1,this.adapter.isScrollEventWaiting())return;const e=Math.max(0,t-this.options.cleanUpRows);if(e<=this.adapter.visible.first)return;const s=this.adapter.syncFrozen?this.adapter.syncFrozen(e):0;this.adapter.removeFromBeginning(this.adapter.visible.first,e-1,s);const{context:i}=this.adapter;let o=(e-this.adapter.visible.first)*i.defaultRowHeight;if(i.exceptions.length>0)for(let t=this.adapter.visible.first;t<e;t+=1){const e=i.exceptionsLookup.get(t);null!=e&&(o+=e-i.defaultRowHeight)}this.adapter.visible.first=e,this.adapter.updateOffset(this.adapter.visibleFirstRowPos+o),this.prefetchDown()}cleanUpBottom(t){this.cleanupTimeout=-1;const e=t+this.options.cleanUpRows;this.adapter.visible.last<=e||(this.adapter.removeFromBottom(e+1,this.adapter.visible.last),this.adapter.visible.last=e,this.prefetchUp())}triggerCleanUp(t,e,s){this.cleanupTimeout>=0&&clearTimeout(this.cleanupTimeout),s&&t-this.options.cleanUpRows<=this.adapter.visible.first||!s&&this.adapter.visible.last<=e+this.options.cleanUpRows||(this.cleanupTimeout=self.setTimeout(s?this.cleanUpTop.bind(this):this.cleanUpBottom.bind(this),this.options.delay,s?t:e))}onScrolled(t,e){this.adapter.isScrollEventWaiting()||(e!==P.ALL&&this.options.cleanUpRows>0&&this.triggerCleanUp(this.adapter.visible.forcedFirst,this.adapter.visible.forcedLast,t),e!==P.NONE&&this.options.prefetchRows>0&&this.triggerPrefetch(t))}}class ot extends q{constructor(t,e,s,i,o={}){super(e,o),this.header=t,this.body=e,this.tableId=s,this.style=i;const n=this;this.cell=new class extends et{get context(){return n.context}get body(){return n.body}get lastScrollInfo(){return n.lastScrollInfo}createHeader(t,e){return n.createHeader(t,e)}updateHeader(t,e){return n.updateHeader(t,e)}createCell(t,e,s){return n.createCell(t,e,s)}updateColumnOffset(t){super.updateColumnOffset(t),n.updateOffset(n.visibleFirstRowPos)}updateCell(t,e,s){return n.updateCell(t,e,s)}forEachRow(t){return n.forEachRow(t)}}(this.header,this.style,s,o.mixins||[])}addColumnMixin(t,e){this.cell.addColumnMixin(t,e)}get idPrefix(){return this.tableId}get width(){return this.context.column.totalHeight}get visibleColumns(){return this.cell.visibleColumns}get visibleFirstColumnPos(){return this.cell.visibleFirstColumnPos}get height(){return this.context.totalHeight}get hidden(){return this.header.classList.contains(O)}set hidden(t){this.hidden!==t&&(this.header.classList.toggle(O,t),this.body.classList.toggle(O,t),this.header.classList.toggle(H,t),this.body.classList.toggle(H,t),this.onVisibilityChanged(!t))}updateSizer(t){this.updateShifts(t,this.cell.leftShift())}updateShifts(t,e){Y(this.body,0,t.toFixed(0))}onVisibilityChanged(t){}hide(){this.hidden=!0}show(t,e,s){const i=this.hidden;this.hidden=!1,i?this.revalidate():this.onScrolledHorizontally(t,e,s)}init(){this.hide(),this.cell.init(),super.init()}destroy(){super.destroy(),this.header.remove(),this.style.remove(this.tableId)}onScrolledVertically(t,e,s){return this.hidden?P.NONE:super.onScrolledVertically(t,e,s)}onScrolledHorizontally(t,e,s){const i=this.cell.onScrolledHorizontally(t,e,s);return this.updateSizer(this.visibleFirstRowPos),i}updateHeaders(){this.cell.updateHeaders()}handleCellReady(t,e,s=-1){return this.cell.handleCellReady(t,e,s)}recycleCell(t,e=-1){this.cell.recycleCell(t,e)}updateColumnWidths(){const{context:t}=this;this.style.update(t.defaultRowHeight-t.padding(-1),t.columns,t.column.padding,0,this.tableId)}recreate(t){const e=this.bodyScroller,s=e.scrollLeft;this.cell.recreate(s,e.clientWidth),super.recreate(t),e.scrollLeft=s}clearPool(){super.clearPool(),this.cell.clearPool()}createRow(t,e){this.cell.createRow(t,e),t.classList.add(this.style.cssClasses.tr)}updateRow(t,e){this.cell.updateRow(t,e)}}class nt{constructor(t,e,s={}){this.node=t,this.tableId=0,this.sections=[],this.options={columnPadding:0,async:y,minScrollDelta:30},Object.assign(this.options,s);const i=e.startsWith("#")?e.slice(1):e;t.id=i,t.innerHTML=`<header id="header-${i}" class="${_} ${$(`header-${i}`)}">\n      <footer class="${I} ${$(`footer-${i}`)}">&nbsp;</footer>\n    </header>\n    <main id="body-${i}" class="${B} ${$(`body-${i}`)}">\n      <footer class="${I}">&nbsp;</footer>\n    </main>`,t.classList.add($(),T,"lineup-engine"),this.style=new tt(this.node,i);let o=b(this.main,this.options.async,(t=>{if(Math.abs(o.left-t.left)<this.options.minScrollDelta&&Math.abs(o.width-t.width)<this.options.minScrollDelta)return;const e=t.left>o.left;o=t,this.onScrolledHorizontally(t.left,t.width,e)}))}update(){this.onScrolledHorizontally(this.main.scrollLeft,this.main.clientWidth,!1);let t=0;this.sections.forEach((e=>{e.body.style.left=`${t}px`,e.header.style.left=`${t}px`,t+=e.width+this.options.columnPadding}))}onScrolledHorizontally(t,e,s){let i=0;const o=t+e;this.sections.forEach((e=>{const n=i+e.width;n<t||i>o?e.hide():e.show(Math.max(0,t-i),Math.min(o-i,e.width),s),i=n+this.options.columnPadding})),this.updateOffset()}updateOffset(){const t=this.header.getElementsByTagName("footer")[0],e=this.main.getElementsByTagName("footer")[0],s=this.sections.reduce(((t,e)=>Math.max(t,e.height)),0),i=this.sections.reduce(((t,e)=>t+e.width+this.options.columnPadding),0);Y(t,i,0),Y(e,i,s)}destroy(){this.sections.forEach((t=>t.destroy())),this.node.remove()}get doc(){return this.node.ownerDocument}get header(){return this.node.getElementsByTagName("header")[0]}get main(){return this.node.getElementsByTagName("main")[0]}pushTable(t,...e){const s=this.doc.createElement("article"),i=this.doc.createElement("article"),o=`${this.node.id}T${this.tableId}`;this.tableId+=1;const n=J(o),r=Q(o);s.id=n.thead,s.classList.add(D,r.thead),i.id=n.tbody,i.classList.add(U,r.tbody),this.header.insertBefore(s,this.header.lastElementChild),this.main.appendChild(i);const l=t.call(this,s,i,o,this.style,...e);return l.init(),this.sections.push(l),this.update(),l}pushSeparator(t,...e){const s=this.doc.createElement("section"),i=this.doc.createElement("section");s.classList.add($("header-separator")),i.classList.add($("separator")),this.header.insertBefore(s,this.header.lastElementChild),this.main.appendChild(i);const o=t.call(this,s,i,this.style,...e);return o.init(),this.sections.push(o),this.update(),o}remove(t){const e=this.sections.indexOf(t);return!(e<0||(this.sections.splice(e,1),t.destroy(),this.update(),0))}clear(){this.sections.splice(0,this.sections.length).forEach((t=>t.destroy())),this.update()}widthChanged(){this.update()}}const rt="2.4.0",lt="20220328-021530";return e})()}));
//# sourceMappingURL=lineupengine.js.map